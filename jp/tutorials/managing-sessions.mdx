---
title: "セッション管理"
description: "上級セッション運用、履歴確認、ストレージ構成、復旧手順のガイド。"
---

## セッション運用を徹底する理由

セッションは MineClawd の長期的な記憶です。整ったセッションフローがあれば、回答の精度が上がり、文脈の誤りが減り、障害からの復旧が素早くなります。

## セッションのスコーピング

- セッションはオーナーごとに分離されます。
- プレイヤーコマンドはプレイヤーの UUID をオーナーキーに使います。
- コンソールコマンドはコマンドソース名をオーナーキーに使います。
- 各オーナーにアクティブなセッションポインタが一つだけあります。
- すべてのセッションコマンドは OP 権限レベル `2` を要求します。

## 毎日のコマンドワークフロー

| 目的 | コマンド | GUI での操作 |
| --- | --- | --- |
| クリーンな文脈を始める | `/mineclawd sessions new` | セッションビューで **New Session** をクリック |
| 保存済みセッションを確認する | `/mineclawd sessions list` | オーバーレイメニューの **Sessions** を開く |
| アクティブセッションを切り替える | `/mineclawd sessions resume <session>` | セッション一覧の行をクリック |
| 古い文脈を削除する | `/mineclawd sessions remove <session>` | -- |
| 現在のチャット履歴を見る | `/mineclawd history` | オーバーレイの会話をスクロール |
| Vertex 関連の破損を修復する | `/mineclawd sessions repair [session]` | -- |

`<session>` には `1a2b` のような短い ID か `1a2b-my-build-plan` のようなトークンを使えます。

<Tip>
短いセッション ID はメモやスクリプト、ランブックで使うのが便利です。ID は安定していますが、トークンのタイトル部は MineClawd がよりよいタイトルを生成すると変わることがあります。
</Tip>

## 長い作業向けのコツ

1. 目的ごとにセッションを分け、1 つのセッションにすべてを詰め込まない。
2. 文脈をリネームしたいときは古い履歴を伸ばすより、新しいセッションを作って切り替える。
3. `resume`、`remove`、`repair` を使う前に `/mineclawd sessions list` を実行する。
4. リクエストがまだ実行中の状態でセッションを変更しない。
5. 破壊的な作業を始める前に `/mineclawd history` で文脈を確認する。

## `/mineclawd history` を有効に使う

- 履歴ブックにはセッショントークン、更新時間、表示可能なチャットターンが出ます。
- このコマンドはプレイヤー専用で、コンソールからは使えません。
- 履歴ブック UI にはクライアント側の MineClawd が必要です。
- 非常に長い履歴は Minecraft 書物のページ制限でトリミングされます。

クライアントに MineClawd が入っていない場合は、`sessions list` と最新のチャットログで代替してください。

## 復旧手順

### リクエストに失敗したが文脈は残したい

最後の失敗メッセージにあるトークンを使って `/mineclawd retry <token>` を実行します。リトライトークンの有効期限は 30 分です。

### Vertex の function-call 不一致エラー

```bash
/mineclawd sessions repair
```

または、特定のセッションが対象なら:

```bash
/mineclawd sessions repair <session>
```

`repair` は壊れた Vertex 関連のターンを正規化し、修復後のセッションを保存します。

## セッションファイルの場所

MineClawd はゲームフォルダーに次のようにセッションを保存します:

```text
mineclawd/
  sessions/
    <owner>/
      active.json
      <id>.json
```

- `active.json` がアクティブなセッション ID を保持します。
- `<id>.json` にメタデータと OpenAI/Vertex の両方の履歴が入ります。
- アクティブセッションを削除すると、MineClawd は直近で更新された残りを自動選択します。残りがなければアクティブポインタをクリアします。

## バックアップと掃除の流れ

1. 大量削除前に `mineclawd/sessions/` をバックアップします。
2. 古いセッションは `/mineclawd sessions remove <session>` で削除します。
3. 各オペレーターは既知の良好なセッションを 1 つ残しておくと即時リカバリできます。
4. ストレージの内部を見たいときは `/resources/technical-details` を参照します。

## 関連ページ

- [GUI の使い方](/tutorials/using-the-gui)
- [/commands/sessions-list](/commands/sessions-list)
- [/commands/sessions-resume](/commands/sessions-resume)
- [/commands/sessions-repair](/commands/sessions-repair)
- [/commands/history](/commands/history)
