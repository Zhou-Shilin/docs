---
title: "Detalles técnicos"
description: "Arquitectura, almacenamiento, límites e internals de runtime de MineClawd."
---

## Ciclo de vida de una solicitud

1. Ejecutas `/mclawd ...` o `/mineclawd prompt ...`.
2. MineClawd valida la configuración del proveedor y el acceso OP.
3. MineClawd carga o crea el estado de sesión activa.
4. MineClawd envía la solicitud a un endpoint compatible con OpenAI o a Vertex.
5. Las respuestas del modelo pueden activar llamadas de herramientas.
6. Los resultados de herramientas se devuelven al bucle del modelo.
7. La salida final del asistente se muestra en el chat y se guarda el historial de sesión.

## Familias de herramientas en runtime

- Ejecución de comandos y scripts:
  - `execute-command`
  - `apply-instant-server-script`
- Archivos de script persistentes:
  - `list-server-scripts`
  - `read-server-script`
  - `write-server-script`
  - `delete-server-script`
  - `reload-game`
  - `sync-command-tree`
- Aclaración:
  - `ask-user-question`
- Marcadores dinámicos (solo cuando están habilitados):
  - `list-dynamic-content`
  - `register-dynamic-item`
  - `register-dynamic-block`
  - `register-dynamic-fluid`
  - `update-dynamic-item`
  - `update-dynamic-block`
  - `update-dynamic-fluid`
  - `unregister-dynamic-content`

## Estructura de almacenamiento

```text
gameDir/
  config/
    mineclawd.json5
  mineclawd/
    player-settings.json
    sessions/
      <owner>/
        active.json
        <id>.json
    souls/
      default.md
      yuki.md
      <custom>.md
      .active/
        <owner>.txt
  kubejs/
    server_scripts/
      mineclawd/
        ...
```

## Internals de sesión

- El id de sesión es un token de 4 caracteres en minúsculas.
- El formato del token de comando es `<id>-<title-slug>`.
- El archivo de sesión almacena por separado los historiales de OpenAI y Vertex.
- El puntero de sesión activa se guarda en `active.json` por propietario.
- El título de sesión se genera tras la primera ronda exitosa usando el modelo de resumen.

## Detalles de transporte LLM

- Ruta de solicitud compatible con OpenAI: `<endpoint>/chat/completions`
- Ruta de solicitud de Vertex: `<endpoint>/<model>:generateContent?key=<api_key>`
- Ambas rutas usan timeout de solicitud de 60 segundos.
- Ambas rutas soportan llamadas de herramientas tipo función.

## Internals de marcadores dinámicos

- Capacidad: `30` slots de ítems, `30` slots de bloques, `30` slots de fluidos.
- Los ids fijos incluyen:
  - `mineclawd:dynamic_item_001`
  - `mineclawd:dynamic_block_001`
  - `mineclawd:dynamic_fluid_001`
- La sincronización de estado usa la carga de red `sync_dynamic_content`.
- La persistencia de estado usa el id de `PersistentState` del mundo `mineclawd_dynamic_content`.
- El modo `AUTO` habilita marcadores de runtime en cliente y los deshabilita en servidores dedicados.

## Canales de red

MineClawd define estos identificadores de paquetes:

- `mineclawd:open_config`
- `mineclawd:sync_broadcast_target`
- `mineclawd:sync_dynamic_content`
- `mineclawd:open_question`
- `mineclawd:question_response`
- `mineclawd:open_history_book`

## Límites y temporizadores

| Ajuste o comportamiento | Valor |
| --- | --- |
| Rango de límite de llamadas de herramientas | `1` a `20` |
| Valor predeterminado del límite de llamadas de herramientas | `16` |
| Estado predeterminado del límite de llamadas de herramientas | deshabilitado |
| Máximo de opciones en ask-user | `5` |
| Timeout de ask-user | `60` segundos |
| TTL del token de reintento de solicitud fallida | `30` minutos |
| Cantidad de reintentos por rate limit | `2` reintentos |
| Backoff de reintento por rate limit | `1500ms * retry_index` |
| Máximo de entradas de historial para construir el libro | `300` |

## Modelo de seguridad

- Todas las rutas de comando están protegidas por OP.
- La ejecución de KubeJS es ejecución real en servidor, no simulación.
- Las claves API deben tratarse como secretos.
- Usa solo entornos de confianza.
